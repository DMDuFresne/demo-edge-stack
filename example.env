# =============================================
# Abelara MES Edge Stack - Environment Configuration
# =============================================
#
# QUICK START:
# 1. Copy this file: cp example.env .env
# 2. Change passwords (search for "REQUIRED")
# 3. Set timezone to your plant location
# 4. Deploy: docker-compose up -d
# 5. Access GraphiQL: http://localhost:5433/graphiql
#
# All variables with defaults are optional
# Required variables are marked with (REQUIRED)

# =============================================
# Global Configuration
# =============================================

# Timezone for all services
TZ=America/Chicago

# =============================================
# Image Tags (Version Control)
# =============================================
# Pin specific versions for production or use defaults
# Defaults are set in docker-compose.yml

IGNITION_TAG=8.3.0
SOLACE_TAG=latest
TIMESCALEDB_TAG=latest-pg17
PGADMIN_TAG=latest
HISTORIAN_TAG=latest
COLLECTOR_TAG=latest
EXPLORER_TAG=latest
BACKUP_TAG=17
WATCHTOWER_TAG=latest
HOMEPAGE_TAG=latest
GLANCES_TAG=latest-full

# =============================================
# PostGraphile GraphQL API Configuration
# =============================================

POSTGRAPHILE_TAG=4                           # PostGraphile version (v4.x.x)
POSTGRAPHILE_PORT=5433                       # GraphQL API port

# Exposed Schemas: mes_core (24 tables), mes_custom (extensions), mes_audit (read-only audit log)
# PostGraphile auto-generates GraphQL API from these PostgreSQL schemas
# All tables enforce soft delete only (no hard DELETE mutations - use removed=true)

# =============================================
# Ignition Gateway Configuration
# =============================================

# Network Ports
IGNITION_HTTP_PORT=8088
IGNITION_HTTPS_PORT=8043
IGNITION_GAN_PORT=8060

# Gateway Settings
GATEWAY_ADMIN_USERNAME=admin
IGNITION_PASSWORD=changeme                    # (REQUIRED) Change in production!
IGNITION_EDITION=standard
GATEWAY_NAME=docker-dev-gateway

# Memory Configuration (MB)
GATEWAY_MAX_MEMORY=2048
GATEWAY_INIT_MEMORY=512

# Licensing (Leave empty if not using)
IGNITION_LICENSE_KEY=
IGNITION_ACTIVATION_TOKEN=
GATEWAY_MODULES_ENABLED=

# Advanced Options
DISABLE_QUICKSTART=false
ALLOW_UNSIGNED_MODULES=true
IGNITION_UID=2003
IGNITION_GID=2003

# =============================================
# Solace PubSub+ Message Broker Configuration
# =============================================

# Credentials
SOLACE_ADMIN_PASSWORD=admin                   # (REQUIRED) Change in production!

# Performance
SOLACE_MAX_CONNECTIONS=100                    # Max concurrent connections

# Ports (if defaults conflict)
SOLACE_MANAGER_PORT=8080                      # PubSub+ Manager web UI
SOLACE_SMF_PORT=55555                         # Solace Message Format
SOLACE_MQTT_PORT=1883                         # MQTT
SOLACE_MQTT_WS_PORT=8000                      # MQTT over WebSocket
SOLACE_AMQP_PORT=5672                         # AMQP
SOLACE_REST_PORT=9000                         # REST messaging
SOLACE_SSH_PORT=2222                          # SSH CLI access

# =============================================
# Database (TimescaleDB) Configuration
# =============================================

POSTGRES_USER=admin                           # (REQUIRED)
POSTGRES_PASSWORD=password                    # (REQUIRED) Change in production!
POSTGRES_EXTERNAL_PORT=5432                   # External PostgreSQL port

# =============================================
# Database Backup Configuration
# =============================================

BACKUP_RETENTION_DAYS=14
BACKUP_ENCRYPTION_KEY=token                   # (REQUIRED) Use strong random key in production!
BACKUP_HEALTHCHECK_PORT=8888                  # Backup service healthcheck endpoint

# =============================================
# pgAdmin Configuration
# =============================================

PGADMIN_PORT=5050
PGADMIN_DEFAULT_EMAIL=admin@example.com       # (REQUIRED)
PGADMIN_DEFAULT_PASSWORD=changeme             # (REQUIRED) Change in production!

# =============================================
# Historian Services Configuration
# =============================================

HISTORIAN_PORT=4511                           # Timebase Historian port
COLLECTOR_PORT=4521                           # Timebase Collector port
EXPLORER_PORT=4531                            # Timebase Explorer port

# =============================================
# Watchtower Configuration
# =============================================

WATCHTOWER_API_TOKEN=token                    # (REQUIRED) Use strong random token in production!
WATCHTOWER_PORT=8070                          # Watchtower API/metrics port

# =============================================
# Homepage (Dashboard) Configuration
# =============================================

HOMEPAGE_PORT=3000

# =============================================
# Glances (System Monitoring) Configuration
# =============================================

GLANCES_PORT=61208

# =============================================
# Docker Network and Volume Names
# =============================================
# Customize volume and network names if needed (useful for multiple deployments)

NETWORK_NAME=abelara-mes-network
TIMESCALEDB_VOLUME_NAME=timescaledb-data
IGNITION_VOLUME_NAME=ignition-data
SOLACE_VOLUME_NAME=solace-data
PGADMIN_VOLUME_NAME=pgadmin-data
HISTORIAN_VOLUME_NAME=historian-data
COLLECTOR_VOLUME_NAME=collector-data
EXPLORER_VOLUME_NAME=explorer-data

# =============================================
# Notes
# =============================================
#
# Security Best Practices:
# 1. Change all passwords and tokens before production deployment
# 2. Use strong, randomly generated values for encryption keys
# 3. All tables use soft delete only (set removed=true, no hard DELETE via API)
# 4. Never commit the .env file to version control
# 5. Consider restricting CORS origins in production
#
# Resource Limits (via x-resources templates in docker-compose.yml):
# - XLARGE (4 CPU, 4G RAM): Ignition, TimescaleDB
# - LARGE (2 CPU, 2G RAM): Solace, Historian
# - MEDIUM (1 CPU, 1G RAM): PostGraphile, Collector
# - SMALL (0.5 CPU, 512M): pgAdmin, Explorer, Redis
# - TINY (0.25 CPU, 256M): Backup, Watchtower, Homepage, Glances
# - Total Reserved: ~13 CPU cores, ~9GB RAM
# - Total Limits: ~20 CPU cores, ~18GB RAM
# - Recommended Hardware: 24 cores, 32GB RAM minimum
#
# Database Architecture:
# - Database name: mes (hardcoded, matches init scripts)
# - Schemas: mes_core (production), mes_custom (extensions), mes_audit (audit log)
# - Hypertables: All *_log tables use TimescaleDB for time-series optimization
# - Soft deletes: ALL tables enforce removed=true (no hard deletes via GraphQL)
# - Schema version tracking: core_schema_version, custom_schema_version
#
# GraphQL API Features:
# - Auto-generated from PostgreSQL schemas (schema-first development)
# - 24+ tables, 16+ views, 10+ functions exposed
# - CRUD operations: Create, Read, Update (no Delete - soft delete only)
# - GraphiQL UI: http://localhost:5433/graphiql
# - API endpoint: http://localhost:5433/graphql
#
# Volume Management:
# - All application data uses named Docker volumes
# - Backups: Daily encrypted backups to ./backups/database (14-day retention)
# - Use 'docker volume ls' to see all volumes
# - Use 'docker volume prune' to clean unused volumes
# - Backup verification runs on container start
#
# Deployment Commands:
# - Start: docker-compose up -d
# - Stop: docker-compose down
# - Clean restart: docker-compose down -v && docker-compose up -d
# - View logs: docker-compose logs -f [service-name]
# - Check status: docker-compose ps
#
